<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>{{ chall_name }}</title>
        <link rel="stylesheet" href="/static/bootstrap.min.css" />

        <!-- Custom styles for this template -->
        <link href="/static/dashboard.css" rel="stylesheet">
    </head>
    <body>
        <div style="margin-left:30%;margin-top:15%">
            <h1>{{ chall_name }}</h1>
            <form  id="captcha_form">
                <label>{{ question }} </label><br>
                <input type="text" placeholder="solution" name="answer">
            </form>
            <button onclick="deploy_image()" >Launch Instance</button>
            <p style="color:red" id="message_field"></p>
            <p id="remaining_time"></p>
        </div>
        <script>
            const deploy_image = async () => {
                $.ajax({
                    type: 'POST',
                    dataType: "json",
                    url: '/deploy'+window.location.pathname,
                    data: JSON.stringify($("form[id='captcha_form']").serialize()).slice(1,-1),
                    success: function(data, status, xhr) {
                        console.log(data);
                        message_field.innerHTML = `A New Instance has been created <a href='http://${window.location.hostname+':'+data.port}' target='_blank'>here</a>`;
                        message_field.style.color = "green";

                        var remaining_time = data.timeout;
                        document.getElementById("remaining_time").style.color = "red";
                        var countDown = setInterval(function(){
                            remaining_time--;
                            document.getElementById("remaining_time").innerText = "Instance will timeout in "+remaining_time+" seconds";
                            if(remaining_time <= 0){
                                clearInterval(countDown);
                                window.location.reload();
                            }
                        }, 1000);
                    },
                    error: function(data, status, xhr) {
                        console.log(data);
                        message_field.innerText = `Wrong/Invalid POW`;
                        message_field.style.color = "red";
                        window.location.reload();
                    }
                }); 
            }

        </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    </body>
</html>

